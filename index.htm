<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="shortcut icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="114x114" href="apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="76x76" href="apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="144x144" href="android-chrome-144x144.png">
    <link rel="icon" type="image/png" sizes="96x96" href="android-chrome-96x96.png">
    <link rel="icon" type="image/png" sizes="48x48" href="android-chrome-48x48.png">
    <meta name="msapplication-TileImage" content="mstile-144x144.png">
    <meta name="msapplication-TileColor" content="#1a1626">
    <meta name="msapplication-config" content="browserconfig.xml">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1626">
    <meta name="msapplication-navbutton-color" content="#1a1626">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="rabbit.wine">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="rabbit.wine">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>Rabbit Wine</title>
    <link rel="stylesheet" href="mainmenu.css">
    <link rel="stylesheet" href="stars.css">
    <link rel="stylesheet" href="modals.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sora:wght@600;700&display=swap">
</head>
<body>
    <div class="background-animation" id="backgroundAnimation"></div>
    <button id="viewToggle" class="view-toggle" aria-label="Toggle menu">
        <img class="view-toggle-logo" src="rabbitwine.png" alt="Rabbit Wine" aria-hidden="true">
        <span class="view-toggle-label">Rabbit Wine Menu</span>
    </button>
    <div id="livingroomShell" class="livingroom-shell">
        <iframe id="livingroomFrame" src="livingroom/index.htm?embed=1" title="Rabbit Wine Livingroom" allow="autoplay; fullscreen"></iframe>
    </div>
    <div id="mainMenuShell" class="main-menu-shell">
    <script>
    // Prevent bfcache and force reload if page is restored from cache
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister();
            }
        });
    }
    window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
            window.location.reload();
        }
    });
    // Detect if navigation is via back/forward
    window.skipMenuAnimation = false;
    try {
        if (window.performance && performance.getEntriesByType) {
            const navs = performance.getEntriesByType('navigation');
            if (navs && navs[0] && navs[0].type === 'back_forward') {
                window.skipMenuAnimation = true;
            }
        }
        if (sessionStorage.getItem('skipMenuAnimation') === '1') {
            window.skipMenuAnimation = true;
        }
        sessionStorage.setItem('skipMenuAnimation', '1');
    } catch (e) {}
    </script>
    
    <div class="intro-container">
        <div class="logo-container" style="margin-top: 4px;">
            <a href="#" id="aboutLogo">
                <img src="rabbitwine.png" alt="rabbit.wine logo" class="logo">
            </a>
        </div>
    <h1 class="title">Rabbit Wine</h1>
        <div class="features-grid">

            <a href="#" class="feature-card" id="livingroomLink">
                <span class="feature-icon">üõãÔ∏è</span>
                <h3 class="feature-title">Livingroom</h3>
            </a>

            <a href="stickers" class="feature-card">
                <span class="feature-icon">üè∑Ô∏è</span>
                <h3 class="feature-title">Stickers</h3>
            </a>

            <a href="editor" class="feature-card">
                <span class="feature-icon">üé®</span>
                <h3 class="feature-title">Editor</h3>
            </a>

            <a href="objects" class="feature-card">
                <span class="feature-icon">ü™®</span>
                <h3 class="feature-title">Objects</h3>
            </a>

            <a href="scroll" class="feature-card">
                <span class="feature-icon">üìÑ</span>
                <h3 class="feature-title">Scroll</h3>
            </a>

            <a href="realities" class="feature-card">
                <span class="feature-icon">üì∑</span>
                <h3 class="feature-title">Realities</h3>
            </a>

            <a href="chaos" class="feature-card">
                <span class="feature-icon">üåÄ</span>
                <h3 class="feature-title">Chaos</h3>
            </a>

<!--
            <a href="space" class="feature-card">
                <span class="feature-icon">üåå</span>
                <h3 class="feature-title">Space</h3>
            </a>
-->

            <a href="jams" class="feature-card">
                <span class="feature-icon">üéµ</span>
                <h3 class="feature-title">Jams</h3>
            </a>

            <a href="midi" class="feature-card">
                <span class="feature-icon">üéπ</span>
                <h3 class="feature-title">Midi</h3>
            </a>

            <a href="brokennes" class="feature-card">
                <span class="feature-icon">üïπÔ∏è</span>
                <h3 class="feature-title">BrokenNes</h3>
            </a>
<!--
            <a href="ask" class="feature-card">
                <span class="feature-icon">üç∑</span>
                <h3 class="feature-title">Ask</h3>
            </a>
-->
        </div>

    </div>
    </div>

    <script src="stars.js"></script>
    <!-- Mini player system (moved from head for proper initialization) -->
    <script src="modals.js"></script>
    <script src="memory.js"></script>
    <script src="musicPlayerCore.js"></script>
    <script src="musicPlayerMini.js"></script>
    <script src="musicPlayerInit.js"></script>
    <script>
    // About modal on logo click
    document.addEventListener('DOMContentLoaded', function() {
        var logo = document.getElementById('aboutLogo');
        if (logo) {
            logo.addEventListener('click', function(e) {
                e.preventDefault();
                var year = new Date().getFullYear();
                var content = document.createElement('div');
                content.innerHTML = `
                  <div class="about-modal-btns" style="display: flex; flex-direction: column; gap: 18px; align-items: center; justify-content: center; margin-bottom: 18px;">
                    <button onclick="window.open('https://github.com/ircluzar/RabbitWine/', '_blank')">
                      <span style='font-size:2em; margin-right:10px;'>üêá</span>
                      <span>Get the source on GitHub</span>
                    </button>
                    <button onclick="window.open('https://redscientist.com/', '_blank')">
                      <span style='font-size:2em; margin-right:10px;'>üåê</span>
                      <span>Developer: redscientist.com</span>
                    </button>
                  </div>
                  <div style="text-align:center; font-weight:bold; margin: 22px 0 22px 0; font-size: 1.2em;">Rabbit Wine Gen 3.1</div>
                  <div class="about-modal-footer">
                    ${year} ‚Äî Developed in the matrix under ircluzar's directives.
                  </div>
                `;
                window.Modals.open({
                  title: 'About Rabbit Wine',
                  content: content,
                  confirmText: 'Close',
                  showCancel: false
                });
            });
        }
    });
    </script>
    <script>
        // Fade in feature cards with staggered delays, unless coming from back/forward navigation
        document.addEventListener('DOMContentLoaded', () => {
            const cards = document.querySelectorAll('.feature-card');
            if (window.skipMenuAnimation) {
                cards.forEach(card => {
                    card.style.opacity = '1';
                    card.style.animation = 'none';
                    card.style.transform = 'none';
                    card.style.animationDelay = '0s';
                    card.classList.remove('fade-in'); // Remove animation class if present
                });
            } else {
                cards.forEach((card, i) => {
                    card.classList.add('fade-in');
                    card.style.animationDelay = (0.09 * i + 0.08) + 's';
                });
            }
        });
        // Add subtle hover effects to feature cards
        document.querySelectorAll('.feature-card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-4px) scale(1.02)';
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0) scale(1)';
            });
        });
    </script>
    <script>
        (function() {
            const livingroomShell = document.getElementById('livingroomShell');
            const mainMenuShell = document.getElementById('mainMenuShell');
            const viewToggle = document.getElementById('viewToggle');
            const livingroomLink = document.getElementById('livingroomLink');
            const livingroomFrame = document.getElementById('livingroomFrame');
            let currentView = 'livingroom';

            const labelEl = viewToggle ? viewToggle.querySelector('.view-toggle-label') : null;

            const setView = (next) => {
                currentView = next;
                const showLivingroom = currentView === 'livingroom';
                livingroomShell.classList.toggle('hidden-shell', !showLivingroom);
                mainMenuShell.classList.toggle('hidden-shell', showLivingroom);
                if (viewToggle) {
                    viewToggle.style.display = showLivingroom ? 'inline-flex' : 'none';
                }
                if (labelEl) {
                    labelEl.textContent = 'Rabbit Wine Menu';
                }
            };

            const sendMusicState = (state) => {
                if (!livingroomFrame || !livingroomFrame.contentWindow) return;
                const playing = !!(state && state.isPlaying && state.hasPlaylist);
                livingroomFrame.contentWindow.postMessage({ type: 'background-music-state', playing }, '*');
            };

            if (viewToggle) {
                viewToggle.addEventListener('click', () => {
                    setView(currentView === 'livingroom' ? 'menu' : 'livingroom');
                });
            }

            if (livingroomLink) {
                livingroomLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    setView('livingroom');
                });
            }

            document.addEventListener('backgroundMusicStateChange', (e) => {
                sendMusicState(e?.detail || null);
            });

            const sendInitialMusicState = () => {
                try {
                    const state = window.BackgroundMusic?.getState?.();
                    if (state) sendMusicState(state);
                } catch (err) {
                    console.warn('Music state send failed', err);
                }
            };

            // Default to Livingroom view on load
            setView('livingroom');
            sendInitialMusicState();
        })();
    </script>
    <style>
    /* Mini player spacing adjustments */
    .intro-container {
        /* Minimize top padding to reduce empty space above logo */
        padding-top: 2px !important;
    }
    .logo-container {
        margin-top: 2px !important;
    }
    .title {
        margin: 32px 0 28px 0 !important;
        padding: 12px 0 !important;
        font-size: 2.8rem;
        font-weight: 700;
        font-family: "Sora", system-ui, -apple-system, sans-serif;
        color: #e2e2e2;
        letter-spacing: 0.04em;
        text-align: center;
        line-height: 1.1;
        /* No background or box-shadow, restore original look */
    }
    .livingroom-shell {
        position: fixed;
        inset: 0;
        z-index: 3;
        display: grid;
        background: #0b0a11;
    }
    .livingroom-shell iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
    .main-menu-shell {
        position: fixed;
        inset: 0;
        z-index: 2;
        overflow: auto;
        display: grid;
        place-items: center;
        padding-top: 32px;
        background: transparent;
    }
    .hidden-shell {
        display: none;
    }
    .view-toggle {
        position: fixed;
        right: 16px;
        bottom: 96px;
        z-index: 4;
        min-width: 180px;
        height: 52px;
        padding: 0 14px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.08);
        background: rgba(17, 19, 26, 0.9);
        color: #9aa0ad;
        font-family: "Sora", system-ui, -apple-system, sans-serif;
        font-weight: 600;
        letter-spacing: 0.08em;
        box-shadow: 0 12px 32px rgba(0,0,0,0.32);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }
    .view-toggle:active {
        transform: translateY(1px);
    }
    @media (max-width: 820px) and (orientation: portrait) {
        .view-toggle {
            right: 12px;
            bottom: 88px;
            min-width: 160px;
            height: 48px;
            font-size: 0.95rem;
        }
    }
    @media (max-width: 600px) {
        .intro-container {
            padding-top: 2px !important;
        }
        .logo-container {
            margin-top: 2px !important;
        }
        .title {
            margin: 22px 0 18px 0 !important;
            padding: 8px 0 !important;
        }
    }

    /* Shrink cards only on short landscape viewports (tablet/phone); keep desktop sized */
    @media (orientation: landscape) and (max-height: 820px) {
        .main-menu-shell {
            place-items: start center;
            padding-top: 16px;
            padding-bottom: 8px;
        }
        .intro-container {
            justify-content: flex-start;
            padding: 6px 10px 10px !important;
            gap: 8px;
            height: auto;
            min-height: 0;
        }
        .title {
            margin: 12px 0 10px 0 !important;
            padding: 4px 0 !important;
            font-size: 2.2rem;
        }
        .features-grid {
            max-width: 720px;
            gap: 0.7rem 0.9rem;
            align-content: flex-start;
            display: grid;
            grid-template-columns: repeat(5, minmax(64px, 1fr));
            justify-items: center;
        }
        .feature-card {
            width: 72px;
            height: 76px;
            padding: 0.45rem 0.2rem 0.25rem 0.2rem;
        }
        .feature-icon {
            font-size: 1.65rem;
        }
        .feature-title {
            font-size: 0.72rem;
        }
    }

    /* Five columns on wider landscape (desktop/laptop) */
    @media (orientation: landscape) and (min-width: 900px) {
        .main-menu-shell {
            place-items: start center;
            padding-top: 16px;
            padding-bottom: 12px;
        }
        .intro-container {
            gap: 8px;
            padding: 8px 14px 12px !important;
            height: auto;
            min-height: 0;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(110px, 1fr));
            max-width: 980px;
            gap: 0.8rem 1rem;
            align-content: flex-start;
            justify-items: center;
        }
        .feature-card {
            width: 110px;
            height: 124px;
            padding: 0.78rem 0.3rem 0.38rem 0.3rem;
        }
        .feature-icon {
            font-size: 2rem;
        }
        .feature-title {
            font-size: 0.86rem;
        }
    }

    .view-toggle-logo {
        width: 20px;
        height: 20px;
        object-fit: contain;
        filter: drop-shadow(0 2px 6px rgba(0,0,0,0.25));
        flex-shrink: 0;
    }

    .view-toggle-label {
        font-size: 12px;
        text-transform: uppercase;
        line-height: 1;
        flex: 1 1 auto;
        text-align: center;
    }
    </style>
</body>
</html>
</html>